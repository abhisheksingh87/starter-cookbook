<!doctype html><html><head><title>WellsFargo Application Modernization Cookbook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2021-01-14T11:09:08 CST"><title>Organize codebase :: WellsFargo Application Modernization Cookbook</title><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link href=/css/nucleus.css rel=stylesheet><link href=/css/font-awesome.min.css rel=stylesheet><link href=/css/hybrid.css rel=stylesheet><link href=/css/featherlight.min.css rel=stylesheet><link href=/css/auto-complete.css rel=stylesheet><link href=/theme-original/style.css rel=stylesheet><link rel=stylesheet href=/css/bootstrap.min.css><script src=/js/jquery-2.x.min.js></script><style type=text/css>:root #header+#content>#left>#rlblock_left{display:none!important}</style><link href=/css/custom.css rel=stylesheet><script language=javascript src=/js/localforage.nopromises.min.js></script></head><body data-url=/best-practices/spring-boot-structure/><div id=headermain></div><nav id=sidebar><div class=highlightable><div id=header-wrapper><div id=header><p><figure><a href=/><img src=/images/wellsfargo.png></a></figure>Application Starter Cookbook</p></div><div class=searchbox><label for=search-by><i class="fa fa-search"></i></label><input data-search-input id=search-by type=text placeholder=Search...>
<span data-search-clear><i class="fa fa-close"></i></span></div><script type=text/javascript src=/js/lunr.min.js></script><script type=text/javascript src=/js/auto-complete.js></script><script type=text/javascript>var baseurl="\/";</script><script type=text/javascript src=/js/search.js></script></div><ul class=topics><li data-nav-id=/common/ class="dd-item haschildren"><div><a href=/common/><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>&nbsp;&nbsp;Let's get started</a><i class="fa fa-angle-right fa-lg category-icon"></i></div><ul><li data-nav-id=/common/create-app-using-starter/ class=dd-item><div><a href=/common/create-app-using-starter/>1. Create barebone microservice using the starter</a></div></li></ul></li><li data-nav-id=/recipes-non-reactive/ class="dd-item haschildren"><div><a href=/recipes-non-reactive/><i class="fa fa-cutlery"></i>&nbsp;&nbsp;Non-Reactive Recipes</a><i class="fa fa-angle-right fa-lg category-icon"></i></div><ul><li data-nav-id=/recipes-non-reactive/configure-actuator/ class=dd-item><div><a href=/recipes-non-reactive/configure-actuator/>2. Configure Actuators</a></div></li><li data-nav-id=/recipes-non-reactive/configure-oracle/ class=dd-item><div><a href=/recipes-non-reactive/configure-oracle/>3. Configure Oracle</a></div></li><li data-nav-id=/recipes-non-reactive/configure-mongodb/ class=dd-item><div><a href=/recipes-non-reactive/configure-mongodb/>4. Configure MongoDB</a></div></li><li data-nav-id=/recipes-non-reactive/accessing-data-mongodb/ class=dd-item><div><a href=/recipes-non-reactive/accessing-data-mongodb/>5. Access Data in MongoDB</a></div></li></ul></li><li data-nav-id=/recipes-reactive/ class="dd-item haschildren"><div><a href=/recipes-reactive/><i class="fa fa-cutlery"></i>&nbsp;&nbsp;Reactive Recipes</a><i class="fa fa-angle-right fa-lg category-icon"></i></div><ul><li data-nav-id=/recipes-reactive/configure-actuator/ class=dd-item><div><a href=/recipes-reactive/configure-actuator/>2. Configure Actuators</a></div></li><li data-nav-id=/recipes-reactive/configure-mongodb/ class=dd-item><div><a href=/recipes-reactive/configure-mongodb/>3. Configure MongoDB</a></div></li><li data-nav-id=/recipes-reactive/accessing-data-mongodb-reactive/ class=dd-item><div><a href=/recipes-reactive/accessing-data-mongodb-reactive/>4. Access Data in MongoDB</a></div></li><li data-nav-id=/recipes-reactive/why-reactive-and-when-to-use/ class=dd-item><div><a href=/recipes-reactive/why-reactive-and-when-to-use/>5. Why Reactive</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-rx-api/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-rx-api/>6. Spring WebFlux lite reactive api</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-annotated-controllers/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-annotated-controllers/>7. Spring WebFlux Annotated Controllers</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-functional-endpoints/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-functional-endpoints/>8. Spring WebFlux Functional Endpoints</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-exception-handling/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-exception-handling/>9. Spring WebFlux Exception Handling</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-webclient/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-webclient/>Spring WebFlux WebClient</a></div></li></ul></li><li data-nav-id=/best-practices/ class="dd-item parent haschildren"><div><a href=/best-practices/><i class="fa fa-book fa-fw"></i>&nbsp;&nbsp;Best Practices</a>
<i class="fa fa-angle-down fa-lg category-icon"></i></div><ul><li data-nav-id=/best-practices/custom-spring-validation/ class=dd-item><div><a href=/best-practices/custom-spring-validation/>Custom Spring Bean Validation</a></div></li><li data-nav-id=/best-practices/git-commit-messages/ class=dd-item><div><a href=/best-practices/git-commit-messages/>Git Commit Best Practices</a></div></li><li data-nav-id=/best-practices/spring-boot-structure/ class="dd-item active"><div><a href=/best-practices/spring-boot-structure/>Organize codebase</a></div></li></ul></li><section id=shortcuts><li role><h5>&nbsp;</h5><a href=/tags/ rel=noopener><i class="fa fa-tag"></i>&nbsp;&nbsp;All Tags</a></li></section><hr><li></li></ul><section id=footer></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fa fa-bars"></i></a></span><span id=toc-menu><i class="fa fa-list-alt"></i></span><span class=links><a href=/>Home</a> > <a href=/best-practices/>Best Practices</a> > Organize codebase</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#context>CONTEXT</a></li><li><a href=#solution>SOLUTION</a><ul><li><a href=#layers>Layers</a></li><li><a href=#api-based-services>API Based Services</a></li><li><a href=#controller-layer>Controller Layer</a></li><li><a href=#service-layer>Service Layer</a></li><li><a href=#integration-layer>Integration Layer</a></li><li><a href=#message-services>Message Services</a></li></ul></li><li><a href=#non-layer-classes>Non-layer Classes</a><ul><li><a href=#models>Models</a></li><li><a href=#application>Application</a></li><li><a href=#config>Config</a></li></ul></li><li><a href=#input-validation>Input Validation</a></li><li><a href=#api-versioning>API Versioning</a><ul><li></li></ul></li><li><a href=#package-organization>Package Organization</a><ul><li></li><li><a href=#package-by-layer-example>Package by Layer Example</a></li><li><a href=#package-by-feature-example>Package by Feature Example</a></li></ul></li></ul></nav></div></div></div><div id=tags><a class="label label-default" href=/tags/practices>practices</a>
<a class="label label-default" href=/tags/spring-boot>spring boot</a>
<a class="label label-default" href=/tags/microservice>microservice</a>
<a class="label label-default" href=/tags/application-development>application development</a></div><br><div id=body-inner><h1>Organize codebase</h1><h2 id=context>CONTEXT</h2><p>This recipe provides details for organizing codebase in a typical spring boot microservice.</p><h2 id=solution>SOLUTION</h2><h3 id=layers>Layers</h3><h4 id=why-even-have-layers-today-what-year-is-this>Why even have layers today? What year is this?</h4><blockquote><p><em>Most of the examples I see have one Spring bean which does configuration, endpoints, data, security, validation and pancakes&mldr;</em></p></blockquote><p>An argument can be made that trivial services (especially focused examples) have no need for the overhead of multiple layers, packages, separation of duties, abstraction, and even basic organization.</p><p>After all, we aren&rsquo;t building monoliths anymore, we&rsquo;re building microsevices right?</p><p>Yes, but we are looking for a balance here between overhead and chaos.</p><p><strong>We know at least the following:</strong></p><ul><li><p>We need just enough abstraction for things to change easily (layers & interfaces)</p></li><li><p>Other developers have to make sense of our code (convention & organization)</p></li><li><p>Our code has to be easily testable (isolation & separation of duties).</p></li><li><p>Another big one: Annotation based frameworks commonly utilize <a href=https://docs.oracle.com/javase/8/docs/technotes/guides/reflection/proxy.html>dynamic proxies</a> which only works on public method calls to spring-injected beans (i.e. hystrix, JPA, transactions etc.)</p></li></ul><blockquote><p><em>But even the Spring Initializr only gives me dependencies, and a single Application class</em></p></blockquote><p>The rest is left to you simply because there are so many options.</p><p>Still here? Let&rsquo;s look at a possible strategy.</p><h3 id=api-based-services>API Based Services</h3><p>Most http/api Spring Boot applications consist of 3 primary layer types.</p><pre><code>       Controller (API Front End - Integration with external consumers)
       
                                   |
                                   v
       
       Services (POJO Capabilities i.e. the valuable stuff)
       
                                   |
                                   v
      
      Integration (Integration with external producers)
</code></pre><p>Integration classes are injected into services, services are injected into controllers or other services for composition.</p><p>Calls through layers go down, never up (no integration classes calling Services).</p><h3 id=controller-layer>Controller Layer</h3><p>This is the API exposure layer. It accepts and returns http request/response and defines how external clients will interact with the service.</p><p>You can organize parts of the API into separate controller classes, though <em>sometimes</em> this is an indication that the service should be split into smaller microservices.</p><p>This should be the only layer that &ldquo;knows&rdquo; it is a webservice at all (don&rsquo;t pass raw http request/response through service layer).</p><blockquote><p><strong>IMPORTANT:</strong> Do not make database calls or calls to other services in the controller.<br>As much as possible, place only http related mapping/translating/versioning code here (and potentially authorization code depending on your design).</p></blockquote><p>It is simply a http adapter to the capabilities of your service.</p><p>The controller layer has the final exception handling responsibilities as well: <a href=https://dzone.com/articles/global-exception-handling-with-controlleradvice>Controller Advice</a></p><h3 id=service-layer>Service Layer</h3><p>This layer contains one or more classes representing the internal composable capabilities of the app.</p><p>The name &ldquo;service&rdquo; used here can sometimes confuse developers new to Spring vernacular. It refers to classes which are the composable, plain Java, &ldquo;middle bit&rdquo; of the application which do not deal with protocols or other integration concerns.</p><p>Services should contain things like business logic, data transformation, user authorization and calls to the DAOs.</p><p>Services can aggregate/compose/orchestrate across other services</p><h3 id=integration-layer>Integration Layer</h3><p>Contains one or more classes which perform integrations with other webservices, databases, message queues, etc.</p><p><strong>Common naming conventions for integration classes depending on their purpose:</strong></p><ul><li>DAO (A bit too generic, but widely used)</li><li>Repository (Mostly CRUD data operations)</li><li>Sender (Message sender over Kafka, JMS, AMQP etc.)</li></ul><blockquote><p>UNIMPORTANT: For an integration which is more than just data operations (think tax calculation), some folks use a different suffix such as &ldquo;Engine&rdquo;.</p></blockquote><p><strong>Example:</strong></p><pre><code>           AccountController
                   |
            AccountService
              /          \
AccountDataService    CustomerService
        /                      \
 *AccountRepo*        *CustomerRepo*
</code></pre><p>Integration classes should follow an interface/implementation pattern.<br><code>AccountRepo</code> would be the interface, <code>JDBCAccountRepo</code> would be a potential implementation of the interface (I know naming things is hard, Please don&rsquo;t call it an &ldquo;Impl&rdquo;)</p><h3 id=message-services>Message Services</h3><p>Message services are structured nearly the same as an API service, but instead of a controller they have a message listener.</p><p><strong>Example:</strong></p><pre><code>          AccountMessageListener
                   |
            AccountService
                   |
             AccountRepo
</code></pre><h2 id=non-layer-classes>Non-layer Classes</h2><h3 id=models>Models</h3><p>Contains plain java classes which represent data passed between the layers of an application.</p><p>Each layer <em>may</em> have its own models depending on the abstraction needed (one model or &ldquo;translate everywhere&rdquo;).</p><p>Many difficult trade-offs are made here between simplicity and abstraction.</p><h3 id=application>Application</h3><p>A single class which declares your app as Spring Boot-able.</p><h3 id=config>Config</h3><p>Any spring bean config which is not embedded in the bean itself (annotations) will go here. This is usually limited to security config and declaration of spring beans that you did not write.</p><h2 id=input-validation>Input Validation</h2><p>Where to do input validation for attribute x is often a subject of debate.<br>Since there is no one right answer for all input types, we&rsquo;ll just list some things to consider when making the decision.</p><p><em>Wherever you choose to validate, it&rsquo;s usually best to move this to its own class.</em></p><p><strong>Considerations:</strong></p><ol><li>Some input validation (format or required elements) can change depending on the API version of the service</li><li>Input validation error responses should include the attribute value and location which caused the error (if safe to do so)</li><li>Some input validation is consistent across API versions and duplication of code may not be desirable</li><li>If you use Spring Bean Validation, you have less code to write but also less control over where/when things happen</li></ol><h2 id=api-versioning>API Versioning</h2><blockquote><p><strong>NOTE:</strong> This section is not meant to be a full API versioning strategy (that&rsquo;s a different recipe).
It should only recommend where to implement a versioning strategy within the layers described above.
If it accidentally oversteps, refer to the main versioning recipe.</p></blockquote><p>API major-versioning should be done as a last resort because it adds a hefty maintenance cost.
Favor backward compatible API changes when possible.</p><p>If you choose to maintain multiple major versions of an API (within the same app) this versioning should be done in the controller. Any data translation which is version specific should be done here.</p><p>Each major version should be represented by a separate controller class</p><p>Example: <code>AccountControllerV1</code> & <code>AccountControllerV2</code></p><h4 id=to-illustrate-consider-the-account-service-which-supports-3-versions-concurrently>To illustrate, consider the <code>account-service</code> which supports 3 versions concurrently:</h4><p><strong>Option #1 - Chaining Translation</strong></p><pre><code>   AccountControllerV1  -&gt; AccountControllerV2  -&gt;  AccountControllerV3
                                                       |
                                                  AccountService
                                                       |
                                                    AccountRepo
</code></pre><p><strong>Option #2 - Direct Translation</strong></p><pre><code>   AccountControllerV1   AccountControllerV2    AccountControllerV3
                   \           |             /
                          AccountService
                               |
                            AccountRepo
</code></pre><p>The <code>AccountService</code> (business logic and orchestration) does not know anything about versioning.
It implicitly represents the highest version.</p><p>The highest version controller (<code>AccountControllerV3</code>) does not do any versioning, it just calls the <code>AccountService </code>.</p><p>Lower version controllers either translate up in a chain (v1->v2->v3) or translate and directly call the <code>AccountService</code> (v1->v3).</p><h4 id=does-this-mean-i-have-a-different-set-of-api-models-for-each-controllerversion>Does this mean I have a different set of API models for each controller/version?</h4><p>If the major version change is non-trivial and involves structural changes to the API model classes, yes. Another reason to avoid this.</p><h2 id=package-organization>Package Organization</h2><p>Again, there are many ways to do this just keep in mind that consistency across projects makes it easier for new developers (though keeping services extremely small makes this slightly less important).</p><h4 id=horizontal-or-vertical-package-by-layer-or-package-by-feature>Horizontal or vertical? Package by layer or package by feature?</h4><p><a href=https://dzone.com/articles/project-package-organization>https://dzone.com/articles/project-package-organization</a></p><h3 id=package-by-layer-example>Package by Layer Example</h3><pre><code>com.wellsfargo.cto.eai/
                   TrackingApplication.java
                   
com.wellsfargo.cto.eai.config/
                   SecurityConfig.java
                   RedisConfig.java
                   
com.wellsfargo.cto.eai.controller/
                   AccountController.java
                   AccountControllerAdvice.java
                   AccountInputValidator.java
                   
com.wellsfargo.cto.eai.controller.model/
                   AccountRequest.java
                   AccountResponse.java
                   ...
                   
com.wellsfargo.cto.eai.model/
                   AccountStatus.java
                   Customer.java
                   ...
                   
com.wellsfargo.cto.eai.service/
                   AccountService.java
                   CustomerService.java
                   
com.wellsfargo.cto.eai.repo/
                   AccountRepo.java
                   JDBCAcountRepo.java
                   CustomerRepo.java
                   CDSCustomerRepo.java
                   
com.wellsfargo.cto.eai.repo.model/
                   Customer.java							
</code></pre><h3 id=package-by-feature-example>Package by Feature Example</h3><aside class=admonition><div class="admonition-content last-updated"><p class=alignleft><a href=/best-practices/spring-boot-structure/ class="hide-child link primary-color">Organize codebase</a> was last updated on December 16, 2020</p></div></aside><footer class=footline></footer><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js></script><script src=/js/featherlight.min.js></script><script src=/js/html5shiv-printshiv.min.js></script><script src=/js/modernizr.custom.71422.js></script><script src=/js/docdock.js></script><script src=/theme-original/script.js></script></body></html>