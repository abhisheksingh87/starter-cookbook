<!doctype html><html><head><title>WellsFargo Application Modernization Cookbook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2020-12-15T10:50:46 CST"><title>Configure Redis Cache :: WellsFargo Application Modernization Cookbook</title><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link href=/css/nucleus.css rel=stylesheet><link href=/css/font-awesome.min.css rel=stylesheet><link href=/css/hybrid.css rel=stylesheet><link href=/css/featherlight.min.css rel=stylesheet><link href=/css/auto-complete.css rel=stylesheet><link href=/theme-original/style.css rel=stylesheet><link rel=stylesheet href=/css/bootstrap.min.css><script src=/js/jquery-2.x.min.js></script><style type=text/css>:root #header+#content>#left>#rlblock_left{display:none!important}</style><link href=/css/custom.css rel=stylesheet><script language=javascript src=/js/localforage.nopromises.min.js></script></head><body data-url=/recipes-non-reactive/configure-redis-cache/><div id=headermain></div><nav id=sidebar><div class=highlightable><div id=header-wrapper><div id=header><p><figure><a href=/><img src=/images/wellsfargo.png></a></figure>Application Starter Cookbook</p></div><div class=searchbox><label for=search-by><i class="fa fa-search"></i></label><input data-search-input id=search-by type=text placeholder=Search...>
<span data-search-clear><i class="fa fa-close"></i></span></div><script type=text/javascript src=/js/lunr.min.js></script><script type=text/javascript src=/js/auto-complete.js></script><script type=text/javascript>var baseurl="\/";</script><script type=text/javascript src=/js/search.js></script></div><ul class=topics><li data-nav-id=/common/ class="dd-item haschildren"><div><a href=/common/><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>&nbsp;&nbsp;Let's get started</a><i class="fa fa-angle-right fa-lg category-icon"></i></div><ul><li data-nav-id=/common/create-app-using-starter/ class=dd-item><div><a href=/common/create-app-using-starter/>Create microservice using the starter</a></div></li></ul></li><li data-nav-id=/recipes-non-reactive/ class="dd-item parent haschildren"><div><a href=/recipes-non-reactive/><i class="fa fa-cutlery"></i>&nbsp;&nbsp;Non-Reactive Recipes</a>
<i class="fa fa-angle-down fa-lg category-icon"></i></div><ul><li data-nav-id=/recipes-non-reactive/configure-oracle/ class=dd-item><div><a href=/recipes-non-reactive/configure-oracle/>Configure Oracle</a></div></li><li data-nav-id=/recipes-non-reactive/configure-redis-cache/ class="dd-item active"><div><a href=/recipes-non-reactive/configure-redis-cache/>Configure Redis Cache</a></div></li></ul></li><li data-nav-id=/recipes-reactive/ class=dd-item><div><a href=/recipes-reactive/><i class="fa fa-cutlery"></i>&nbsp;&nbsp;Reactive Recipes</a></div></li><li data-nav-id=/best-practices/ class="dd-item haschildren"><div><a href=/best-practices/><i class="fa fa-book fa-fw"></i>&nbsp;&nbsp;Best Practices</a><i class="fa fa-angle-right fa-lg category-icon"></i></div><ul><li data-nav-id=/best-practices/custom-spring-validation/ class=dd-item><div><a href=/best-practices/custom-spring-validation/>Custom Spring Bean Validation</a></div></li><li data-nav-id=/best-practices/spring-boot-structure/ class=dd-item><div><a href=/best-practices/spring-boot-structure/>Structuring Spring Boot</a></div></li></ul></li><section id=shortcuts><li role><h5>&nbsp;</h5><a href=/tags/ rel=noopener><i class="fa fa-tag"></i>&nbsp;&nbsp;All Tags</a></li></section><hr><li></li></ul><section id=footer></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fa fa-bars"></i></a></span><span id=toc-menu><i class="fa fa-list-alt"></i></span><span class=links><a href=/>Home</a> > <a href=/recipes-non-reactive/>Non-Reactive Recipes</a> > Configure Redis Cache</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#context>Context</a><ul><li><a href=#prerequisite>Prerequisite</a></li></ul></li><li><a href=#solution>Solution</a><ul><li><a href=#validation>Validation</a></li></ul></li><li><a href=#how-to-enable-caching-in-your-application->How to enable caching in your application ?</a></li><li><a href=#next-step>Next Step</a></li><li><a href=#notes-and-references>Notes and References</a><ul><li><a href=#recommendations>Recommendations</a></li></ul></li></ul></nav></div></div></div><div id=tags><a class="label label-default" href=/tags/starter>starter</a>
<a class="label label-default" href=/tags/spring-boot-app>spring-boot-app</a>
<a class="label label-default" href=/tags/microservice>microservice</a></div><br><div id=body-inner><h1>Configure Redis Cache</h1><h2 id=context>Context</h2><p>This recipe is part of a cookbook for developing a modern <em>cloud ready</em> microservice using the <strong>greenfield-app-starter</strong>. This recipe deals with configuring the microservice to use a distributed (Redis) cache for data caching needs within the application.</p><h3 id=prerequisite>Prerequisite</h3><ul><li><strong>STEP 1: CREATE APPLICATION USING STARTER</strong> is completed.</li></ul><h2 id=solution>Solution</h2><ol><li><p>Determine and record the following <strong>redis cache connection details</strong></p><table><thead><tr><th style=text-align:left>Property</th><th style=text-align:left>Values</th></tr></thead><tbody><tr><td style=text-align:left>redis server name</td><td style=text-align:left>hostname without address path</td></tr><tr><td style=text-align:left>redis host</td><td style=text-align:left>hostname or ip address</td></tr><tr><td style=text-align:left>username</td><td style=text-align:left>schema username</td></tr><tr><td style=text-align:left>password</td><td style=text-align:left>schema password</td></tr><tr><td style=text-align:left>timeout</td><td style=text-align:left>connection timeout in ms</td></tr><tr><td style=text-align:left>time-to-live</td><td style=text-align:left>default TTL in minutes</td></tr><tr><td style=text-align:left>enable-repository</td><td style=text-align:left>true or false; use Redis cache as repository</td></tr></tbody></table></li><li><p>Determine and record the <strong>cache connection pool requirements</strong> for the new microservice</p><table><thead><tr><th style=text-align:left>Property</th><th style=text-align:left>Suggested Values</th></tr></thead><tbody><tr><td style=text-align:left>max-active</td><td style=text-align:left>5</td></tr><tr><td style=text-align:left>max-idle</td><td style=text-align:left>2</td></tr><tr><td style=text-align:left>min-idle</td><td style=text-align:left>1</td></tr><tr><td style=text-align:left>max-wait</td><td style=text-align:left>in ms</td></tr><tr><td style=text-align:left>cluster-nodes</td><td style=text-align:left>atleast 1 host:port pair; &lt;comma separated host:port pairs></td></tr><tr><td style=text-align:left>sentinel-nodes</td><td style=text-align:left>atleast 1 host:port; &lt;comma separated host:port pairs></td></tr></tbody></table></li><li><p>Navigate to the <code>&lt;microservice></code> directory</p></li><li><p>Update <code>src/main/resources/application.yml</code> with Redis (<em>connection, credentials and connection pool</em>) details.</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#bbb>   </span><span style=color:#062873;font-weight:700>application</span>:<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#062873;font-weight:700>name</span>:<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#062873;font-weight:700>description</span>:<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#062873;font-weight:700>id</span>:<span style=color:#bbb> </span>&lt;wells fargo distributed-id&gt;<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#062873;font-weight:700>persistence</span>:<span style=color:#bbb>
</span><span style=color:#bbb>       </span>.....<span style=color:#bbb>
</span><span style=color:#bbb>       </span>.....<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#062873;font-weight:700>cache</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#062873;font-weight:700>redis</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;redis server name&gt; <span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>host</span>:<span style=color:#bbb> </span>&lt;hostname or ip address of the redis cache&gt;<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>port</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>username</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>password</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>timeout</span>:<span style=color:#bbb> </span>&lt;in ms&gt;<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>time-to-live</span>:<span style=color:#bbb> </span>&lt;in minutes&gt;<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>enable-repository</span>:<span style=color:#bbb> </span>&lt;true or false&gt;<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#062873;font-weight:700>connection-pool</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>max-active</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>max-idle</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>max-wait</span>:<span style=color:#bbb> </span>&lt;in ms&gt;<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>min-idle</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>cluster-nodes</span>:<span style=color:#bbb> </span>&lt;comma seperated host:port pairs&gt;<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#062873;font-weight:700>sentinel-nodes</span>:<span style=color:#bbb> </span>&lt;comma seperated host:port pairs&gt;<span style=color:#bbb>
</span></code></pre></div></li></ol><h3 id=validation>Validation</h3><ol><li><p>Open a command window in the <code>&lt;microservice-name></code> directory</p></li><li><p>Validate the new microservice can be built locally: <code>gradlew bootJar</code></p></li><li><p>Validate the new microservice runs locally: <code>gradlew bootRun</code></p></li><li><p>Verify microservice health and info in the browser</p><ul><li><p><code>http://localhost:8080/actuator/info</code></p></li><li><p><code>http://localhost:8080/actuator/health</code><br>the <em>redis cache details</em> and <em>uptime status</em> should be displayed in the browser.</p></li></ul></li></ol><h2 id=how-to-enable-caching-in-your-application->How to enable caching in your application ?</h2><ul><li><p>add <code>@EnableCaching</code> to one of your <code>configuration classes</code>. (preferably the
class annotated with <code>@SpringBootApplication</code>)</p></li><li><p>add <code>@Cacheable</code> to the methods you want to enable caching.</p></li><li><p>optionally, add <code>@CacheEvict</code> to remove/delete the cached
object.</p></li></ul><p>Here is a example that demonstrates the annotations in a typical service.</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#555;font-weight:700>@Service</span>
<span style=color:#007020;font-weight:700>public</span> <span style=color:#007020;font-weight:700>class</span> <span style=color:#0e84b5;font-weight:700>ItemService</span> <span style=color:#666>{</span>

<span style=color:#007020;font-weight:700>private</span> <span style=color:#007020;font-weight:700>final</span> ItemRepository itemRepository<span style=color:#666>;</span>

    <span style=color:#007020;font-weight:700>public</span> <span style=color:#06287e>ItemService</span><span style=color:#666>(</span>ItemRepository itemRepository<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#007020;font-weight:700>this</span><span style=color:#666>.</span><span style=color:#4070a0>itemRepository</span> <span style=color:#666>=</span> itemRepository<span style=color:#666>;</span>
    <span style=color:#666>}</span>

    <span style=color:#007020;font-weight:700>public</span> List<span style=color:#666>&lt;</span>Item<span style=color:#666>&gt;</span> <span style=color:#06287e>items</span><span style=color:#666>()</span> <span style=color:#666>{</span>
        <span style=color:#007020;font-weight:700>return</span> itemRepository<span style=color:#666>.</span><span style=color:#4070a0>findAll</span><span style=color:#666>();</span>
    <span style=color:#666>}</span>

    <span style=color:#555;font-weight:700>@Cacheable</span><span style=color:#666>(</span>value <span style=color:#666>=</span> <span style=color:#4070a0>&#34;items&#34;</span><span style=color:#666>,</span> key <span style=color:#666>=</span> <span style=color:#4070a0>&#34;#id&#34;</span><span style=color:#666>)</span>
    <span style=color:#007020;font-weight:700>public</span> Item <span style=color:#06287e>getItem</span><span style=color:#666>(</span>Integer id<span style=color:#666>)</span> <span style=color:#666>{</span>
        Item item <span style=color:#666>=</span> itemRepository<span style=color:#666>.</span><span style=color:#4070a0>findById</span><span style=color:#666>(</span>id<span style=color:#666>);</span>
        <span style=color:#007020;font-weight:700>return</span> item<span style=color:#666>;</span>
    <span style=color:#666>}</span>

    <span style=color:#007020;font-weight:700>public</span> Item <span style=color:#06287e>createItem</span><span style=color:#666>(</span>Item item<span style=color:#666>)</span> <span style=color:#666>{</span>
        <span style=color:#007020;font-weight:700>return</span> itemRepository<span style=color:#666>.</span><span style=color:#4070a0>save</span><span style=color:#666>(</span>item<span style=color:#666>);</span>
    <span style=color:#666>}</span>

    <span style=color:#555;font-weight:700>@CacheEvict</span><span style=color:#666>(</span>value <span style=color:#666>=</span> <span style=color:#4070a0>&#34;items&#34;</span><span style=color:#666>,</span> key <span style=color:#666>=</span> <span style=color:#4070a0>&#34;#id&#34;</span><span style=color:#666>)</span>
    <span style=color:#007020;font-weight:700>public</span> Item <span style=color:#06287e>updateItem</span><span style=color:#666>(</span>Integer id<span style=color:#666>,</span> Item request<span style=color:#666>)</span> <span style=color:#666>{</span>
        Item item <span style=color:#666>=</span> getItem<span style=color:#666>(</span>id<span style=color:#666>);</span>
        item<span style=color:#666>.</span><span style=color:#4070a0>setPrice</span><span style=color:#666>(</span>request<span style=color:#666>.</span><span style=color:#4070a0>getPrice</span><span style=color:#666>());</span>
        item<span style=color:#666>.</span><span style=color:#4070a0>setProductName</span><span style=color:#666>(</span>request<span style=color:#666>.</span><span style=color:#4070a0>getProductName</span><span style=color:#666>());</span>
        <span style=color:#007020;font-weight:700>return</span> itemRepository<span style=color:#666>.</span><span style=color:#4070a0>save</span><span style=color:#666>(</span>item<span style=color:#666>);</span>
    <span style=color:#666>}</span>
<span style=color:#666>}</span>
</code></pre></div><h2 id=next-step>Next Step</h2><p>Configure the Messaging</p><h2 id=notes-and-references>Notes and References</h2><h3 id=recommendations>Recommendations</h3><ul><li><p><strong>Cacheable objects must be Serializable</strong></p><p>The reason is due to how redis stores java objects. The safest way to store
objects outside JVM is to write them into serialized bytes. To do that, those classes must implement Serializable.</p></li><li><p><strong>Set the TTL</strong></p><p>Take advantage of expiring keys and Redis will clean up for you</p></li><li><p><strong>Choosing the Proper Eviction Policy</strong></p><p>When your Redis instance fills up, Redis will attempt to evict keys.
Depending on your use case, we recommend <em>volatile-lru</em> assuming you have expiring keys. If you’re running like a cache and don’t have an expiry set, you could consider <em>allkeys-lru</em>.</p></li><li><p><strong>Try not to cache large objects.</strong></p><p>Large objects in the cache will cause performance issues.</p></li><li><p><strong>Make sure all applications using the same cache are at the same version.</strong></p><p>Cached objects created by application with the version A may not be
compatible to the application with the version B. These type of situations
will yield unpredictable results.</p></li></ul><aside class=admonition><div class="admonition-content last-updated"><p class=alignleft><a href=/recipes-non-reactive/configure-redis-cache/ class="hide-child link primary-color">Configure Redis Cache</a> was last updated on December 14, 2020</p></div></aside><footer class=footline></footer><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js></script><script src=/js/featherlight.min.js></script><script src=/js/html5shiv-printshiv.min.js></script><script src=/js/modernizr.custom.71422.js></script><script src=/js/docdock.js></script><script src=/theme-original/script.js></script></body></html>