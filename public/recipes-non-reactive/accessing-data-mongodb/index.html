<!doctype html><html><head><title>WellsFargo Application Modernization Cookbook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2021-01-07T13:23:19 CST"><title>5. Access Data in MongoDB :: WellsFargo Application Modernization Cookbook</title><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link href=/css/nucleus.css rel=stylesheet><link href=/css/font-awesome.min.css rel=stylesheet><link href=/css/hybrid.css rel=stylesheet><link href=/css/featherlight.min.css rel=stylesheet><link href=/css/auto-complete.css rel=stylesheet><link href=/theme-original/style.css rel=stylesheet><link rel=stylesheet href=/css/bootstrap.min.css><script src=/js/jquery-2.x.min.js></script><style type=text/css>:root #header+#content>#left>#rlblock_left{display:none!important}</style><link href=/css/custom.css rel=stylesheet><script language=javascript src=/js/localforage.nopromises.min.js></script></head><body data-url=/recipes-non-reactive/accessing-data-mongodb/><div id=headermain></div><nav id=sidebar><div class=highlightable><div id=header-wrapper><div id=header><p><figure><a href=/><img src=/images/wellsfargo.png></a></figure>Application Starter Cookbook</p></div><div class=searchbox><label for=search-by><i class="fa fa-search"></i></label><input data-search-input id=search-by type=text placeholder=Search...>
<span data-search-clear><i class="fa fa-close"></i></span></div><script type=text/javascript src=/js/lunr.min.js></script><script type=text/javascript src=/js/auto-complete.js></script><script type=text/javascript>var baseurl="\/";</script><script type=text/javascript src=/js/search.js></script></div><ul class=topics><li data-nav-id=/common/ class="dd-item haschildren"><div><a href=/common/><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>&nbsp;&nbsp;Let's get started</a><i class="fa fa-angle-right fa-lg category-icon"></i></div><ul><li data-nav-id=/common/create-app-using-starter/ class=dd-item><div><a href=/common/create-app-using-starter/>1. Create barebone microservice using the starter</a></div></li></ul></li><li data-nav-id=/recipes-non-reactive/ class="dd-item parent haschildren"><div><a href=/recipes-non-reactive/><i class="fa fa-cutlery"></i>&nbsp;&nbsp;Non-Reactive Recipes</a>
<i class="fa fa-angle-down fa-lg category-icon"></i></div><ul><li data-nav-id=/recipes-non-reactive/configure-actuator/ class=dd-item><div><a href=/recipes-non-reactive/configure-actuator/>2. Configure Actuators</a></div></li><li data-nav-id=/recipes-non-reactive/configure-oracle/ class=dd-item><div><a href=/recipes-non-reactive/configure-oracle/>3. Configure Oracle</a></div></li><li data-nav-id=/recipes-non-reactive/configure-mongodb/ class=dd-item><div><a href=/recipes-non-reactive/configure-mongodb/>4. Configure MongoDB</a></div></li><li data-nav-id=/recipes-non-reactive/accessing-data-mongodb/ class="dd-item active"><div><a href=/recipes-non-reactive/accessing-data-mongodb/>5. Access Data in MongoDB</a></div></li></ul></li><li data-nav-id=/recipes-reactive/ class="dd-item haschildren"><div><a href=/recipes-reactive/><i class="fa fa-cutlery"></i>&nbsp;&nbsp;Reactive Recipes</a><i class="fa fa-angle-right fa-lg category-icon"></i></div><ul><li data-nav-id=/recipes-reactive/spring-webflux-webclient/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-webclient/>10.Spring WebFlux WebClient</a></div></li><li data-nav-id=/recipes-reactive/configure-actuator/ class=dd-item><div><a href=/recipes-reactive/configure-actuator/>2. Configure Actuators</a></div></li><li data-nav-id=/recipes-reactive/configure-mongodb/ class=dd-item><div><a href=/recipes-reactive/configure-mongodb/>3. Configure MongoDB</a></div></li><li data-nav-id=/recipes-reactive/accessing-data-mongodb-reactive/ class=dd-item><div><a href=/recipes-reactive/accessing-data-mongodb-reactive/>4. Access Data in MongoDB</a></div></li><li data-nav-id=/recipes-reactive/why-reactive-and-when-to-use/ class=dd-item><div><a href=/recipes-reactive/why-reactive-and-when-to-use/>5. Why Reactive</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-rx-api/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-rx-api/>6. Spring WebFlux lite reactive api</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-annotated-controllers/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-annotated-controllers/>7. Spring WebFlux Annotated Controllers</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-functional-endpoints/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-functional-endpoints/>8. Spring WebFlux Functional Endpoints</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-exception-handling/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-exception-handling/>9. Spring WebFlux Exception Handling</a></div></li></ul></li><li data-nav-id=/best-practices/ class="dd-item haschildren"><div><a href=/best-practices/><i class="fa fa-book fa-fw"></i>&nbsp;&nbsp;Best Practices</a><i class="fa fa-angle-right fa-lg category-icon"></i></div><ul><li data-nav-id=/best-practices/custom-spring-validation/ class=dd-item><div><a href=/best-practices/custom-spring-validation/>Custom Spring Bean Validation</a></div></li><li data-nav-id=/best-practices/git-commit-messages/ class=dd-item><div><a href=/best-practices/git-commit-messages/>Git Commit Best Practices</a></div></li><li data-nav-id=/best-practices/spring-boot-structure/ class=dd-item><div><a href=/best-practices/spring-boot-structure/>Organize codebase</a></div></li></ul></li><section id=shortcuts><li role><h5>&nbsp;</h5><a href=/tags/ rel=noopener><i class="fa fa-tag"></i>&nbsp;&nbsp;All Tags</a></li></section><hr><li></li></ul><section id=footer></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fa fa-bars"></i></a></span><span id=toc-menu><i class="fa fa-list-alt"></i></span><span class=links><a href=/>Home</a> > <a href=/recipes-non-reactive/>Non-Reactive Recipes</a> > 5. Access Data in MongoDB</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#context>CONTEXT</a></li><li><a href=#solution>SOLUTION</a></li><li><a href=#define-entity>Define Entity</a></li><li><a href=#create-queries>Create Queries</a></li><li><a href=#testing>Testing</a></li><li><a href=#note>NOTE</a></li></ul></nav></div></div></div><div id=tags><a class="label label-default" href=/tags/persistence>persistence</a>
<a class="label label-default" href=/tags/data-repository>data-repository</a>
<a class="label label-default" href=/tags/mongodb>mongodb</a>
<a class="label label-default" href=/tags/spring-boot>spring boot</a></div><br><div id=body-inner><h1>5. Access Data in MongoDB</h1><h2 id=context>CONTEXT</h2><p>This guide walks you through the process of using Spring Data MongoDB to build an
application that stores data in and retrieves it from <a href=https://www.mongodb.org/>MongoDB</a>, a
document-based database.</p><h2 id=solution>SOLUTION</h2><h2 id=define-entity>Define Entity</h2><p>MongoDB is a NoSQL document store. In this example, you store <code>Customer</code> objects.</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>  <span style=color:#555;font-weight:700>@Builder</span>
  <span style=color:#555;font-weight:700>@AllArgsConstructor</span>
  <span style=color:#555;font-weight:700>@Getter</span>
  <span style=color:#555;font-weight:700>@Setter</span>
  <span style=color:#555;font-weight:700>@ToString</span>
  <span style=color:#007020;font-weight:700>public</span> <span style=color:#007020;font-weight:700>class</span> <span style=color:#0e84b5;font-weight:700>Account</span> <span style=color:#666>{</span>

    <span style=color:#555;font-weight:700>@Id</span>
    <span style=color:#007020;font-weight:700>private</span> String id<span style=color:#666>;</span>
    <span style=color:#007020;font-weight:700>private</span> Long accountNumber<span style=color:#666>;</span>
    <span style=color:#007020;font-weight:700>private</span> Long routingNumber<span style=color:#666>;</span>
    <span style=color:#007020;font-weight:700>private</span> String accountOwner<span style=color:#666>;</span>
<span style=color:#666>}</span>
</code></pre></div><ol><li><p><strong>Account</strong> class has four attributes: <strong>id</strong>, <strong>accountNumber</strong>, <strong>routingNumber</strong> and <strong>accountOwner</strong>.
The <strong>id</strong> is mostly for internal use by MongoDB. You also have a single constructor to
populate the entities when creating a new instance.</p></li><li><p><strong>id</strong> fits the standard name for a MongoDB ID, so it does not require any special
annotation to tag it for Spring Data MongoDB.</p></li><li><p>The other three properties, <strong>accountNumber</strong>, <strong>routingNumber</strong> and <strong>accountOwner</strong> are left unannotated.
It is assumed that they are mapped to fields that share the same name as the properties themselves.</p></li></ol><p>The convenient <strong>@ToString()</strong> method prints out the details about a customer.</p><hr><p><strong>NOTE</strong></p><ol><li>MongoDB stores data in collections. Spring Data MongoDB maps the <strong>Customer</strong> class
into a collection called <strong>customer</strong>. If you want to change the name of the collection, you
can use Spring Data MongoDB&rsquo;s
<a href=https://docs.spring.io/spring-data/data-mongodb/docs/current/api/org/springframework/data/mongodb/core/mapping/Document.html>@Document</a>
annotation on the class.</li></ol><hr><h2 id=create-queries>Create Queries</h2><p>Spring Data MongoDB focuses on storing data in MongoDB. It also inherits functionality
from the Spring Data Commons project, such as the ability to derive queries.</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>  <span style=color:#007020;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>org.springframework.data.mongodb.repository.MongoRepository</span><span style=color:#666>;</span>

  <span style=color:#007020;font-weight:700>public</span> <span style=color:#007020;font-weight:700>interface</span> <span style=color:#0e84b5;font-weight:700>AccountRepository</span> <span style=color:#007020;font-weight:700>extends</span> MongoRepository<span style=color:#666>&lt;</span>Account<span style=color:#666>,</span> String<span style=color:#666>&gt;</span> <span style=color:#666>{</span>
  
     Account <span style=color:#06287e>findByAccountOwner</span><span style=color:#666>(</span>String accountOwner<span style=color:#666>);</span>
  
     <span style=color:#555;font-weight:700>@Query</span><span style=color:#666>(</span><span style=color:#4070a0>&#34;{ &#39;accountNumber&#39;: ?0, &#39;routingNumber&#39;: ?1}&#34;</span><span style=color:#666>)</span>
     Account <span style=color:#06287e>findByAccountNumberAndRoutingNumber</span><span style=color:#666>(</span>Long accountNumber<span style=color:#666>,</span> Long routingNumber<span style=color:#666>);</span>
  <span style=color:#666>}</span>
</code></pre></div><ol><li><p><strong>AccountRepository</strong> extends the <strong>MongoRepository</strong> interface and plugs in the type of
values and ID that it works with: <strong>Account</strong> and <strong>String</strong>, respectively. MongoRepository
in turn extends <strong>PagingAndSortingRepository</strong> interface defined in Spring Data Commons.</p></li><li><p>You can define other queries by declaring their method signatures. In this case, add
<code>findByAccountOwner</code>, which essentially seeks documents of type <strong>Account</strong> and finds the
documents that match on <code>accountOwner</code>.</p></li><li><p>You also have <code>findByAccountNumberAndRoutingNumber</code>, which finds account by <strong>accountnumber</strong> and <strong>routingnumber</strong>.</p></li></ol><h2 id=testing>Testing</h2><p>Using Junit5 and Spring&rsquo;s TestContext framework to create MongoDB repository Integration tests</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#555;font-weight:700>@ExtendWith</span><span style=color:#666>(</span>SpringExtension<span style=color:#666>.</span><span style=color:#4070a0>class</span><span style=color:#666>)</span>
    <span style=color:#555;font-weight:700>@SpringBootTest</span><span style=color:#666>(</span>webEnvironment <span style=color:#666>=</span> SpringBootTest<span style=color:#666>.</span><span style=color:#4070a0>WebEnvironment</span><span style=color:#666>.</span><span style=color:#4070a0>RANDOM_PORT</span><span style=color:#666>,</span> classes <span style=color:#666>=</span> GreenfieldReactiveApplication<span style=color:#666>.</span><span style=color:#4070a0>class</span><span style=color:#666>)</span>
    <span style=color:#007020;font-weight:700>public</span> <span style=color:#007020;font-weight:700>class</span> <span style=color:#0e84b5;font-weight:700>AccountRepositoryTest</span> <span style=color:#666>{</span>
    
        <span style=color:#555;font-weight:700>@Autowired</span>
        <span style=color:#007020;font-weight:700>private</span> AccountRepository accountRepository<span style=color:#666>;</span>


        <span style=color:#555;font-weight:700>@Test</span>
        <span style=color:#007020;font-weight:700>public</span> <span style=color:#902000>void</span> <span style=color:#06287e>testSave</span><span style=color:#666>()</span> <span style=color:#666>{</span>
            <span style=color:#60a0b0;font-style:italic>//when
</span><span style=color:#60a0b0;font-style:italic></span>            Account account <span style=color:#666>=</span> repository<span style=color:#666>.</span><span style=color:#4070a0>save</span><span style=color:#666>(</span><span style=color:#007020;font-weight:700>new</span> Account<span style=color:#666>(</span><span style=color:#007020;font-weight:700>null</span><span style=color:#666>,</span> 918345L<span style=color:#666>,</span> 234518L<span style=color:#666>,</span> <span style=color:#4070a0>&#34;alex&#34;</span><span style=color:#666>));</span>
            
            <span style=color:#60a0b0;font-style:italic>//then
</span><span style=color:#60a0b0;font-style:italic></span>            assertThat<span style=color:#666>(</span>account<span style=color:#666>.</span><span style=color:#4070a0>getId</span><span style=color:#666>()).</span><span style=color:#4070a0>isNotNull</span><span style=color:#666>();</span>
        <span style=color:#666>}</span>
    
        <span style=color:#555;font-weight:700>@Test</span>
        <span style=color:#007020;font-weight:700>public</span> <span style=color:#902000>void</span> <span style=color:#06287e>testFindById</span><span style=color:#666>()</span> <span style=color:#666>{</span>
            <span style=color:#60a0b0;font-style:italic>//given
</span><span style=color:#60a0b0;font-style:italic></span>            Account account <span style=color:#666>=</span> repository<span style=color:#666>.</span><span style=color:#4070a0>save</span><span style=color:#666>(</span><span style=color:#007020;font-weight:700>new</span> Account<span style=color:#666>(</span><span style=color:#007020;font-weight:700>null</span><span style=color:#666>,</span> 918345L<span style=color:#666>,</span> 234518L<span style=color:#666>,</span> <span style=color:#4070a0>&#34;alex&#34;</span><span style=color:#666>));</span>
    
            <span style=color:#60a0b0;font-style:italic>//when
</span><span style=color:#60a0b0;font-style:italic></span>            Account createdCustomerAccount <span style=color:#666>=</span> repository<span style=color:#666>.</span><span style=color:#4070a0>findById</span><span style=color:#666>(</span>account<span style=color:#666>.</span><span style=color:#4070a0>getId</span><span style=color:#666>());</span>
    
            <span style=color:#60a0b0;font-style:italic>//then
</span><span style=color:#60a0b0;font-style:italic></span>            assertThat<span style=color:#666>(</span><span style=color:#4070a0>&#34;alex&#34;</span><span style=color:#666>).</span><span style=color:#4070a0>isEqualTo</span><span style=color:#666>(</span>createdCustomerAccount<span style=color:#666>.</span><span style=color:#4070a0>getAccountOwner</span><span style=color:#666>());</span>
            assertThat<span style=color:#666>(</span>234518L<span style=color:#666>).</span><span style=color:#4070a0>isEqualTo</span><span style=color:#666>(</span>createdCustomerAccount<span style=color:#666>.</span><span style=color:#4070a0>getRoutingNumber</span><span style=color:#666>());</span>
            assertThat<span style=color:#666>(</span>createdCustomerAccount<span style=color:#666>.</span><span style=color:#4070a0>getId</span><span style=color:#666>()).</span><span style=color:#4070a0>isNotNull</span><span style=color:#666>();</span>
        <span style=color:#666>}</span>

         <span style=color:#555;font-weight:700>@Test</span>
         <span style=color:#007020;font-weight:700>public</span> <span style=color:#902000>void</span> <span style=color:#06287e>testFindByAccountNumberAndRoutingNumber</span><span style=color:#666>()</span> <span style=color:#666>{</span>
            <span style=color:#60a0b0;font-style:italic>//given
</span><span style=color:#60a0b0;font-style:italic></span>            Account account <span style=color:#666>=</span> repository<span style=color:#666>.</span><span style=color:#4070a0>save</span><span style=color:#666>(</span><span style=color:#007020;font-weight:700>new</span> Account<span style=color:#666>(</span><span style=color:#007020;font-weight:700>null</span><span style=color:#666>,</span> 918345L<span style=color:#666>,</span> 234518L<span style=color:#666>,</span> <span style=color:#4070a0>&#34;alex&#34;</span><span style=color:#666>));</span>
      
            <span style=color:#60a0b0;font-style:italic>//when
</span><span style=color:#60a0b0;font-style:italic></span>            Account createdCustomerAccount <span style=color:#666>=</span> repository<span style=color:#666>.</span><span style=color:#4070a0>findByAccountNumberAndRoutingNumber</span><span style=color:#666>(</span>account<span style=color:#666>.</span><span style=color:#4070a0>getAccountNumber</span><span style=color:#666>(),</span> account<span style=color:#666>.</span><span style=color:#4070a0>getRoutingNumber</span><span style=color:#666>);</span>
      
            <span style=color:#60a0b0;font-style:italic>//then
</span><span style=color:#60a0b0;font-style:italic></span>            assertThat<span style=color:#666>(</span><span style=color:#4070a0>&#34;alex&#34;</span><span style=color:#666>).</span><span style=color:#4070a0>isEqualTo</span><span style=color:#666>(</span>createdCustomerAccount<span style=color:#666>.</span><span style=color:#4070a0>getAccountOwner</span><span style=color:#666>());</span>
            assertThat<span style=color:#666>(</span>234518L<span style=color:#666>).</span><span style=color:#4070a0>isEqualTo</span><span style=color:#666>(</span>createdCustomerAccount<span style=color:#666>.</span><span style=color:#4070a0>getRoutingNumber</span><span style=color:#666>());</span>
            assertThat<span style=color:#666>(</span>createdCustomerAccount<span style=color:#666>.</span><span style=color:#4070a0>getId</span><span style=color:#666>()).</span><span style=color:#4070a0>isNotNull</span><span style=color:#666>();</span>
         <span style=color:#666>}</span>
    <span style=color:#666>}</span>
</code></pre></div><hr><h2 id=note>NOTE</h2><aside class=admonition><div class="admonition-content last-updated"><p class=alignleft><a href=/recipes-non-reactive/accessing-data-mongodb/ class="hide-child link primary-color">5. Access Data in MongoDB</a> was last updated on December 17, 2020</p></div></aside><footer class=footline></footer><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js></script><script src=/js/featherlight.min.js></script><script src=/js/html5shiv-printshiv.min.js></script><script src=/js/modernizr.custom.71422.js></script><script src=/js/docdock.js></script><script src=/theme-original/script.js></script></body></html>