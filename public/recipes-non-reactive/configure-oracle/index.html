<!doctype html><html><head><title>WellsFargo Application Modernization Cookbook</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2021-01-07T12:50:22 CST"><title>3. Configure Oracle :: WellsFargo Application Modernization Cookbook</title><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link href=/css/nucleus.css rel=stylesheet><link href=/css/font-awesome.min.css rel=stylesheet><link href=/css/hybrid.css rel=stylesheet><link href=/css/featherlight.min.css rel=stylesheet><link href=/css/auto-complete.css rel=stylesheet><link href=/theme-original/style.css rel=stylesheet><link rel=stylesheet href=/css/bootstrap.min.css><script src=/js/jquery-2.x.min.js></script><style type=text/css>:root #header+#content>#left>#rlblock_left{display:none!important}</style><link href=/css/custom.css rel=stylesheet><script language=javascript src=/js/localforage.nopromises.min.js></script></head><body data-url=/recipes-non-reactive/configure-oracle/><div id=headermain></div><nav id=sidebar><div class=highlightable><div id=header-wrapper><div id=header><p><figure><a href=/><img src=/images/wellsfargo.png></a></figure>Application Starter Cookbook</p></div><div class=searchbox><label for=search-by><i class="fa fa-search"></i></label><input data-search-input id=search-by type=text placeholder=Search...>
<span data-search-clear><i class="fa fa-close"></i></span></div><script type=text/javascript src=/js/lunr.min.js></script><script type=text/javascript src=/js/auto-complete.js></script><script type=text/javascript>var baseurl="\/";</script><script type=text/javascript src=/js/search.js></script></div><ul class=topics><li data-nav-id=/common/ class="dd-item haschildren"><div><a href=/common/><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>&nbsp;&nbsp;Let's get started</a><i class="fa fa-angle-right fa-lg category-icon"></i></div><ul><li data-nav-id=/common/create-app-using-starter/ class=dd-item><div><a href=/common/create-app-using-starter/>1. Create barebone microservice using the starter</a></div></li></ul></li><li data-nav-id=/recipes-non-reactive/ class="dd-item parent haschildren"><div><a href=/recipes-non-reactive/><i class="fa fa-cutlery"></i>&nbsp;&nbsp;Non-Reactive Recipes</a>
<i class="fa fa-angle-down fa-lg category-icon"></i></div><ul><li data-nav-id=/recipes-non-reactive/configure-actuator/ class=dd-item><div><a href=/recipes-non-reactive/configure-actuator/>2. Configure Actuators</a></div></li><li data-nav-id=/recipes-non-reactive/configure-oracle/ class="dd-item active"><div><a href=/recipes-non-reactive/configure-oracle/>3. Configure Oracle</a></div></li><li data-nav-id=/recipes-non-reactive/configure-mongodb/ class=dd-item><div><a href=/recipes-non-reactive/configure-mongodb/>4. Configure MongoDB</a></div></li><li data-nav-id=/recipes-non-reactive/accessing-data-mongodb/ class=dd-item><div><a href=/recipes-non-reactive/accessing-data-mongodb/>5. Access Data in MongoDB</a></div></li></ul></li><li data-nav-id=/recipes-reactive/ class="dd-item haschildren"><div><a href=/recipes-reactive/><i class="fa fa-cutlery"></i>&nbsp;&nbsp;Reactive Recipes</a><i class="fa fa-angle-right fa-lg category-icon"></i></div><ul><li data-nav-id=/recipes-reactive/spring-webflux-webclient/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-webclient/>10.Spring WebFlux WebClient</a></div></li><li data-nav-id=/recipes-reactive/configure-actuator/ class=dd-item><div><a href=/recipes-reactive/configure-actuator/>2. Configure Actuators</a></div></li><li data-nav-id=/recipes-reactive/configure-mongodb/ class=dd-item><div><a href=/recipes-reactive/configure-mongodb/>3. Configure MongoDB</a></div></li><li data-nav-id=/recipes-reactive/accessing-data-mongodb-reactive/ class=dd-item><div><a href=/recipes-reactive/accessing-data-mongodb-reactive/>4. Access Data in MongoDB</a></div></li><li data-nav-id=/recipes-reactive/why-reactive-and-when-to-use/ class=dd-item><div><a href=/recipes-reactive/why-reactive-and-when-to-use/>5. Why Reactive</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-rx-api/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-rx-api/>6. Spring WebFlux lite reactive api</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-annotated-controllers/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-annotated-controllers/>7. Spring WebFlux Annotated Controllers</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-functional-endpoints/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-functional-endpoints/>8. Spring WebFlux Functional Endpoints</a></div></li><li data-nav-id=/recipes-reactive/spring-webflux-exception-handling/ class=dd-item><div><a href=/recipes-reactive/spring-webflux-exception-handling/>9. Spring WebFlux Exception Handling</a></div></li></ul></li><li data-nav-id=/best-practices/ class="dd-item haschildren"><div><a href=/best-practices/><i class="fa fa-book fa-fw"></i>&nbsp;&nbsp;Best Practices</a><i class="fa fa-angle-right fa-lg category-icon"></i></div><ul><li data-nav-id=/best-practices/custom-spring-validation/ class=dd-item><div><a href=/best-practices/custom-spring-validation/>Custom Spring Bean Validation</a></div></li><li data-nav-id=/best-practices/git-commit-messages/ class=dd-item><div><a href=/best-practices/git-commit-messages/>Git Commit Best Practices</a></div></li><li data-nav-id=/best-practices/spring-boot-structure/ class=dd-item><div><a href=/best-practices/spring-boot-structure/>Organize codebase</a></div></li></ul></li><section id=shortcuts><li role><h5>&nbsp;</h5><a href=/tags/ rel=noopener><i class="fa fa-tag"></i>&nbsp;&nbsp;All Tags</a></li></section><hr><li></li></ul><section id=footer></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fa fa-bars"></i></a></span><span id=toc-menu><i class="fa fa-list-alt"></i></span><span class=links><a href=/>Home</a> > <a href=/recipes-non-reactive/>Non-Reactive Recipes</a> > 3. Configure Oracle</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#context>CONTEXT</a><ul><li><a href=#prerequisite>Prerequisite</a></li></ul></li><li><a href=#solution>SOLUTION</a><ul><li><a href=#validation>Validation</a></li></ul></li><li><a href=#notes>NOTES</a></li></ul></nav></div></div></div><div id=tags><a class="label label-default" href=/tags/persistence>persistence</a>
<a class="label label-default" href=/tags/hikari>hikari</a>
<a class="label label-default" href=/tags/database-connection-pool>database connection pool</a>
<a class="label label-default" href=/tags/anti-patterns>anti patterns</a></div><br><div id=body-inner><h1>3. Configure Oracle</h1><h2 id=context>CONTEXT</h2><p>This recipe is part of a cookbook for developing a modern <em>cloud ready</em> microservice using the <strong>greenfield-app-starter</strong>.<br>This recipe deals with configuring Oracle to fulfill persistence needs in the microservice.<br>A <em>Hikari</em> datasource bean with connection pooling is created after completing this recipe.</p><h3 id=prerequisite>Prerequisite</h3><ul><li><strong>STEP 1: CREATE APPLICATION USING THE STARTER</strong> is completed.</li></ul><h2 id=solution>SOLUTION</h2><ol><li><p>Define <strong>environment variables</strong> for <strong>oracle database connection properties</strong>,
these are usually defined in uDeploy and <strong>never</strong> hardcoded in<code>application.yml</code></p><table><thead><tr><th style=text-align:left>Property</th><th style=text-align:left>Details</th></tr></thead><tbody><tr><td style=text-align:left><code>ORACLE_DB_URL</code></td><td style=text-align:left><code>jdbc:oracle:thin:@&lt;host>:&lt;port>:&lt;schema></code> [thin] OR <code>jdbc:oracle:oci:@&lt;host>:&lt;port>:&lt;schema></code> [oci]</td></tr><tr><td style=text-align:left><code>ORACLE_SCHEMA</code></td><td style=text-align:left>database schema name</td></tr><tr><td style=text-align:left><code>ORACLE_USERNAME</code></td><td style=text-align:left>username</td></tr><tr><td style=text-align:left><code>ORACLE_PASSWORD</code></td><td style=text-align:left>encrypted password</td></tr></tbody></table></li><li><p>Tweak (<em>if necessary</em>) the default <strong>database connection pool settings</strong> after reviewing the <a href=https://github.com/pbelathur/spring-boot-performance-analysis><strong>anti-patterns</strong></a>.</p><table><thead><tr><th style=text-align:left>Property</th><th style=text-align:left>Description</th><th style=text-align:left>Starter Default</th></tr></thead><tbody><tr><td style=text-align:left><code>max-pool-size</code></td><td style=text-align:left>maximum size that the pool is allowed to reach, includes both idle and in-use connections</td><td style=text-align:left>10</td></tr><tr><td style=text-align:left><code>min-idle</code></td><td style=text-align:left>minimum number of idle connections, for efficient performance keep this value at 50% of max-pool-size or less</td><td style=text-align:left>5</td></tr><tr><td style=text-align:left><code>connection-timeout</code></td><td style=text-align:left>the maximum number of milliseconds that a client will wait for a connection from the pool. If this time is exceeded without a connection becoming available, a SQLException will be thrown. Minimum values is 250ms.</td><td style=text-align:left>1000</td></tr><tr><td style=text-align:left><code>idle-timeout</code></td><td style=text-align:left>the maximum amount of time a connection is allowed to sit idle in the pool. This setting only applies when <code>min-idle</code> &lt; <code>max-pool-size.</code> Minimum is 10000ms (10s).</td><td style=text-align:left>10000</td></tr><tr><td style=text-align:left><code>max-lifetime</code></td><td style=text-align:left>the maximum lifetime of a connection in the pool. Minimum values allowed is 30000ms (30s)</td><td style=text-align:left>1800000</td></tr></tbody></table><p><strong>NOTE</strong></p><ul><li>refrain from increasing the <code>max-pool-size</code> beyond 15</li><li>the <code>connection-timeout</code>can be increased by small increments for networks with higher than normal latencies.</li></ul></li><li><p>Navigate to the <code>&lt;microservice></code> directory</p></li><li><p>Review the <em>database connection</em> and <em>connection pool</em> properties in <code>src/main/resources/application.yml</code></p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#062873;font-weight:700>application</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#062873;font-weight:700>id</span>:<span style=color:#bbb> </span>&lt;wells fargo distributed-id&gt;<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#062873;font-weight:700>persistence</span>:<span style=color:#bbb>
</span><span style=color:#bbb>   </span><span style=color:#062873;font-weight:700>oracle</span>:<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#062873;font-weight:700>name</span>:<span style=color:#bbb> </span>oracle-datasource<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#062873;font-weight:700>url</span>:<span style=color:#bbb> </span>${oracle.db.url}<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#062873;font-weight:700>username</span>:<span style=color:#bbb> </span>${oracle.username}<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#062873;font-weight:700>password</span>:<span style=color:#bbb> </span>${oracle.password}<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#062873;font-weight:700>schema</span>:<span style=color:#bbb> </span>${oracle.schema}<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#062873;font-weight:700>dialect</span>:<span style=color:#bbb> </span>org.hibernate.dialect.Oracle12cDialect<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#062873;font-weight:700>driver</span>:<span style=color:#bbb> </span>oracle.jdbc.OracleDriver<span style=color:#bbb>
</span><span style=color:#bbb>     </span><span style=color:#062873;font-weight:700>connection-pool</span>:<span style=color:#bbb>
</span><span style=color:#bbb>       </span><span style=color:#062873;font-weight:700>max-pool-size</span>:<span style=color:#bbb> </span><span style=color:#40a070>10</span><span style=color:#bbb>
</span><span style=color:#bbb>       </span><span style=color:#062873;font-weight:700>idle-pool-size</span>:<span style=color:#bbb> </span><span style=color:#40a070>2</span><span style=color:#bbb>
</span><span style=color:#bbb>       </span><span style=color:#062873;font-weight:700>connection-timeout</span>:<span style=color:#bbb> </span><span style=color:#40a070>500</span><span style=color:#bbb>
</span><span style=color:#bbb>       </span><span style=color:#062873;font-weight:700>idle-timeout</span>:<span style=color:#bbb> </span><span style=color:#40a070>800</span><span style=color:#bbb>
</span><span style=color:#bbb>       </span><span style=color:#062873;font-weight:700>max-lifetime</span>:<span style=color:#bbb> </span><span style=color:#40a070>3000</span><span style=color:#bbb>
</span></code></pre></div></li></ol><ul><li>replace <code>&lt;wells fargo distributed-id></code> with the <strong>distributed ID</strong></li><li>the <code>placeholder</code> property is defined as an <strong>environment variable</strong> in uDeploy.<ul><li>e.g. environment variable: <code>ORACLE_DB_URL</code> corresponds to <code>${oracle.db.url}</code></li><li>the <code>${placeholder}</code> is used for <em>automatic variable expansion</em> during microservice startup.</li></ul></li></ul><h3 id=validation>Validation</h3><ol><li><p>Open a command window in the <code>&lt;microservice-name></code> directory</p></li><li><p>Set all the required <strong>environment variables</strong> for the <em>property placeholder</em>s in<code>application.yml</code></p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#007020>set</span> <span style=color:#bb60d5>ORACLE_DB_URL</span><span style=color:#666>=</span>jdbc:oracle:thin:@&lt;host&gt;:&lt;port&gt;:&lt;schema&gt;
<span style=color:#007020>set</span> <span style=color:#bb60d5>ORACLE_SCHEMA</span><span style=color:#666>=</span>schema-name
<span style=color:#007020>set</span> <span style=color:#bb60d5>ORACLE_USERNAME</span><span style=color:#666>=</span>username
<span style=color:#007020>set</span> <span style=color:#bb60d5>ORACLE_PASSWORD</span><span style=color:#666>=</span>encrypted password
</code></pre></div></li><li><p>Validate the new microservice &mldr;</p><ul><li>can be built locally: <code>gradlew clean bootJar</code></li><li>runs locally: <code>java -jar build/libs/&lt;app-name>-&lt;version>.jar</code></li></ul></li><li><p>Verify microservice health in the browser</p><ul><li><p><code>http://localhost:8080/actuator/info</code></p></li><li><p><code>http://localhost:8080/actuator/health</code><br>the <em>datasource details</em> and <em>uptime status</em> should be displayed in the browser.</p></li><li><p><code>http://localhost:8080/actuator/beans</code><br>search for <em>HikariDataSource</em> in the browser.</p></li></ul></li></ol><h2 id=notes>NOTES</h2><ul><li><a href=https://github.com/pbelathur/spring-boot-performance-analysis>database connection pool <strong>anti-patterns</strong></a></li></ul><aside class=admonition><div class="admonition-content last-updated"><p class=alignleft><a href=/recipes-non-reactive/configure-oracle/ class="hide-child link primary-color">3. Configure Oracle</a> was last updated on January 5, 2021</p></div></aside><footer class=footline></footer><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js></script><script src=/js/featherlight.min.js></script><script src=/js/html5shiv-printshiv.min.js></script><script src=/js/modernizr.custom.71422.js></script><script src=/js/docdock.js></script><script src=/theme-original/script.js></script></body></html>